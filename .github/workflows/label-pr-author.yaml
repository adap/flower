name: Label PR Author as Internal or External

on:
  pull_request:
    types: [opened, reopened, ready_for_review, synchronize, labeled, unlabeled]

permissions:  
  pull-requests: write
  issues: write       

jobs:
  label-author-type:
    runs-on: ubuntu-22.04

    steps:
      - name: Auto-label PR author
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            const labels = pr.labels.map(label => label.name);

            const hasLabel = labels.includes("Maintainer") || labels.includes("Contributor");
            if (hasLabel || pr.state !== "open") {
              console.log("PR already labeled or not open â€” skipping.");
              return;
            }

            const org = "adap";
            const author = pr.user.login;
            const { status } = await github.rest.orgs.checkMembershipForUser({
              org,
              username: author
            }).catch(e => ({ status: e.status }));

            const label = status === 204 ? "Maintainer" : "Contributor";

            console.log(`Adding label: ${label}`);
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              labels: [label]
            });
