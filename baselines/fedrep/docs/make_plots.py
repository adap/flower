"""Generate plots from json files."""

import json
import os
from typing import List, Tuple

import matplotlib.pyplot as plt


def read_from_results(path) -> Tuple[str, str, List, str, str]:
    """Load the json file with recorded configurations and results."""
    with open(path, "r") as fin:
        data = json.load(fin)
        algorithm = data["run_config"]["algorithm"]
        model = data["run_config"]["model-name"]
        accuracies = [res["accuracy"] * 100 for res in data["round_res"]]
        dataset = data["run_config"]["dataset-name"]
        num_classes = data["run_config"]["dataset-split-num-classes"]

        return algorithm, model, accuracies, dataset, num_classes


def make_plot(dir_path, plt_title) -> None:
    """Given a directory with json files, generated a plot using the provided title."""
    plt.figure()
    with os.scandir(dir_path) as files:
        for file in files:
            algo, m, acc, d, n = read_from_results(file)
            rounds = [i + 1 for i in range(len(acc))]
            print(f"Max accuracy ({algo}): {max(acc):.2f}")
            plt.plot(rounds, acc, label=f"{algo}-{d}-{n}classes")
    plt.xlabel("Rounds")
    plt.ylabel("Accuracy")
    plt.title(plt_title)
    plt.grid()
    plt.legend()
    plt.savefig(f"{plt_title}-{algo}")


if __name__ == "__main__":
    # Plot results generated by the baseline.
    directory = "../results/"
    title = "Federated Accuracy over Rounds"
    make_plot(directory, plt_title=title)
